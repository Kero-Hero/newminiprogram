<!--pages/data/data.wxml-->
<view class="page">
  <!-- æ—¶é—´ç­›é€‰åŒºåŸŸ -->
  <view class="filter-section">
    <view class="filter-header">
      <text class="filter-title">æ•°æ®ç­›é€‰</text>
      <view class="filter-reset" bindtap="resetFilter">é‡ç½®</view>
    </view>
    <view class="date-filters">
      <view class="date-item">
        <text class="date-label">å¼€å§‹æ—¶é—´</text>
        <picker mode="date" value="{{startDate}}" bindchange="onStartDateChange">
          <view class="date-picker">
            <text>{{startDate || 'è¯·é€‰æ‹©'}}</text>
            <text class="picker-icon">ğŸ“…</text>
          </view>
        </picker>
      </view>
      <view class="date-item">
        <text class="date-label">ç»“æŸæ—¶é—´</text>
        <picker mode="date" value="{{endDate}}" bindchange="onEndDateChange">
          <view class="date-picker">
            <text>{{endDate || 'è¯·é€‰æ‹©'}}</text>
            <text class="picker-icon">ğŸ“…</text>
          </view>
        </picker>
      </view>
    </view>
    <view class="quick-filters">
      <view class="quick-filter-item {{activeQuickFilter === 'today' ? 'active' : ''}}" bindtap="setQuickFilter" data-type="today">ä»Šå¤©</view>
      <view class="quick-filter-item {{activeQuickFilter === 'week' ? 'active' : ''}}" bindtap="setQuickFilter" data-type="week">æœ€è¿‘7å¤©</view>
      <view class="quick-filter-item {{activeQuickFilter === 'month' ? 'active' : ''}}" bindtap="setQuickFilter" data-type="month">æœ€è¿‘30å¤©</view>
    </view>
  </view>

  <!-- æ•°æ®ç»Ÿè®¡ -->
  <view class="data-stats">
    <view class="stat-item">
      <view class="stat-number">{{totalRecords}}</view>
      <view class="stat-label">æ€»è®°å½•æ•°</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{todayRecords}}</view>
      <view class="stat-label">ä»Šæ—¥è®°å½•</view>
    </view>
    <view class="stat-item">
      <view class="stat-number">{{activeDevices}}</view>
      <view class="stat-label">æ´»è·ƒè®¾å¤‡</view>
    </view>
  </view>

  <!-- æœç´¢æ  -->
  <view class="search-section">
    <view class="search-bar">
      <input class="search-input" placeholder="æœç´¢è®¾å¤‡åç§°æˆ–æ•°æ®å†…å®¹" value="{{searchKeyword}}" bindinput="onSearchInput" />
      <view class="search-icon">ğŸ”</view>
    </view>
    <view class="export-btn" bindtap="exportData">
      <text>ğŸ“¥ å¯¼å‡º</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- æ•°æ®åˆ—è¡¨ -->
  <view class="data-list" wx:else>
    <view class="data-item" wx:for="{{filteredData}}" wx:key="id" bindtap="viewDataDetail" data-item="{{item}}">
      <view class="data-header">
        <view class="device-info">
          <text class="device-name">{{item.deviceName || 'æœªçŸ¥è®¾å¤‡'}}</text>
          <text class="data-type">{{item.dataType || 'ä¼ æ„Ÿå™¨æ•°æ®'}}</text>
        </view>
        <view class="data-time">{{item.formattedTime}}</view>
      </view>
      <view class="data-content">
        <view class="data-value">
          <text class="value-label">{{item.valueLabel || 'æ•°å€¼'}}:</text>
          <text class="value-number">{{item.value}} {{item.unit || ''}}</text>
        </view>
        <view class="data-status">
          <view class="status-dot {{item.status || 'normal'}}"></view>
          <text class="status-text">{{item.statusText || 'æ­£å¸¸'}}</text>
        </view>
      </view>
      <view class="data-metadata" wx:if="{{item.metadata}}">
        <text class="metadata-text">{{item.metadata}}</text>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{filteredData.length === 0 && !loading}}">
      <view class="empty-icon">ğŸ“Š</view>
      <view class="empty-text">{{searchKeyword ? 'æœªæ‰¾åˆ°ç›¸å…³æ•°æ®' : 'æš‚æ— æ•°æ®è®°å½•'}}</view>
      <view class="empty-desc">{{searchKeyword ? 'è¯·å°è¯•å…¶ä»–å…³é”®è¯æˆ–è°ƒæ•´æ—¶é—´èŒƒå›´' : 'è®¾å¤‡æ•°æ®ä¼šåœ¨è¿™é‡Œæ˜¾ç¤º'}}</view>
    </view>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMoreData">
    <text>åŠ è½½æ›´å¤š</text>
  </view>

  <!-- æ•°æ®è¯¦æƒ…å¼¹çª— -->
  <view class="modal-overlay" wx:if="{{showDataDetail}}" bindtap="hideDataDetail">
    <view class="modal-content" catchtap="">
      <view class="modal-header">
        <text class="modal-title">æ•°æ®è¯¦æƒ…</text>
        <view class="modal-close" bindtap="hideDataDetail">âœ•</view>
      </view>
      <view class="modal-body">
        <view class="detail-item" wx:if="{{selectedData}}">
          <text class="detail-label">è®¾å¤‡åç§°:</text>
          <text class="detail-value">{{selectedData.deviceName}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedData}}">
          <text class="detail-label">æ•°æ®ç±»å‹:</text>
          <text class="detail-value">{{selectedData.dataType}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedData}}">
          <text class="detail-label">æ•°å€¼:</text>
          <text class="detail-value">{{selectedData.value}} {{selectedData.unit}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedData}}">
          <text class="detail-label">è®°å½•æ—¶é—´:</text>
          <text class="detail-value">{{selectedData.timestamp}}</text>
        </view>
        <view class="detail-item" wx:if="{{selectedData && selectedData.metadata}}">
          <text class="detail-label">é™„åŠ ä¿¡æ¯:</text>
          <text class="detail-value">{{selectedData.metadata}}</text>
        </view>
      </view>
      <view class="modal-footer">
        <button class="btn btn-primary" bindtap="hideDataDetail">å…³é—­</button>
      </view>
    </view>
  </view>
</view> 